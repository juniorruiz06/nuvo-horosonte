#!/bin/bash

set -e

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ  ๐๏ธ  MINERAL-AGENT - Iniciador Completo                 โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# Colores
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

# Limpiar puertos
echo "๐งน Limpiando puertos anteriores..."
lsof -ti:8000 | xargs kill -9 2>/dev/null || true
lsof -ti:3000 | xargs kill -9 2>/dev/null || true
sleep 1

# Terminal 1: Backend
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "1๏ธโฃ  Iniciando Backend en 0.0.0.0:8000"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

python setup_db.py > /dev/null 2>&1 || true

python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000 &
BACKEND_PID=$!
sleep 3

echo ""
echo -e "${GREEN}โ Backend iniciado (PID: $BACKEND_PID)${NC}"
echo -e "${BLUE}   ๐ API: http://localhost:8000${NC}"
echo -e "${BLUE}   ๐ Docs: http://localhost:8000/docs${NC}"
echo ""

# Terminal 2: Frontend
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "2๏ธโฃ  Iniciando Frontend en 0.0.0.0:3000"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

cd frontend
npm run dev &
FRONTEND_PID=$!
sleep 5

echo ""
echo -e "${GREEN}โ Frontend iniciado (PID: $FRONTEND_PID)${NC}"
echo -e "${BLUE}   ๐ URL: http://localhost:3000${NC}"
echo ""

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ SISTEMA COMPLETAMENTE INICIADO"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ Instrucciones:"
echo "  1. Abre http://localhost:3000 en tu navegador"
echo "  2. Si ves 'Backend Conectado' en verde = TODO OK โ"
echo "  3. Presiona Ctrl+C para detener todo"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

wait
